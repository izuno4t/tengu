# TASKS

## Task List

### Phase 0: 完了済み基盤

|ID|Status|Summary|DependsOn|
|----|--------|---------|-----------|
|TASK-001|✅|要件対応マトリクスを作成する|-|
|TASK-002|✅|アーキテクチャ概要ドキュメントを作成する|TASK-001|
|TASK-003|✅|設定ローダーとデフォルト値実装を作成する|TASK-002|
|TASK-004|✅|モデルプロバイダー抽象化を実装する|TASK-002|
|TASK-005|✅|ツール実行基盤と内蔵ツール群を実装する|TASK-002|

### Phase 1: 起動・基本動作の確認

|ID|Status|Summary|DependsOn|
|----|--------|---------|-----------|
|TASK-006|✅|起動とワンショットの動作確認を完了する|TASK-003,TASK-004,TASK-005|
|TASK-011|✅|出力フォーマットの実装と確認を完了する|TASK-006|
|TASK-012|✅|システムプロンプト階層制御の確認を完了する|TASK-003,TASK-006|

### Phase 2: LLM・ファイル・セッションの確認

|ID|Status|Summary|DependsOn|
|----|--------|---------|-----------|
|TASK-007|✅|LLM最小問い合わせの実装と確認を完了する|TASK-004,TASK-006|
|TASK-008|✅|ファイル系ツールの確認を完了する|TASK-005,TASK-006|
|TASK-009|✅|セッション永続化と再開の確認を完了する|TASK-003,TASK-006|
|TASK-024|✅|エージェント実行ループの最小動作を完了する|TASK-004,TASK-005,TASK-006|
|TASK-010|✅|TUI基本操作の確認を完了する|TASK-009|
|TASK-025|✅|対話TUIでLLM問い合わせを完了する|TASK-007,TASK-006|
|TASK-026|✅|セッション索引を廃止して一覧生成に切替える|TASK-009|
|TASK-027|✅|エージェントにツール実行連携を実装する|TASK-024,TASK-005|
|TASK-028|✅|計画→実行ループの最小実装を完了する|TASK-024|
|TASK-029|✅|ツール選択ロジックの最小実装を完了する|TASK-027|
|TASK-030|✅|変更差分の提示と適用を完了する|TASK-027|
|TASK-031|✅|失敗時の再試行とエラー共有を完了する|TASK-028|

### Phase 3: UI・権限・連携の確認

|ID|Status|Summary|DependsOn|
|----|--------|---------|-----------|
|TASK-013|✅|パーミッションとサンドボックスの確認を完了する|TASK-003,TASK-005,TASK-006|
|TASK-014|✅|MCP統合の確認を完了する|TASK-003,TASK-005,TASK-006|
|TASK-032|✅|MCPプロトコル仕様メモを作成する|-|
|TASK-033|✅|MCP設定ファイルmcp.tomlの読み書きを実装する|TASK-032|
|TASK-034|✅|MCPサーバー管理コマンドの永続化を実装する|TASK-033|
|TASK-035|✅|STDIO MCP接続とツール検出を実装する|TASK-033|
|TASK-036|✅|HTTP/SSE MCP接続とツール検出を実装する|TASK-033|
|TASK-037|✅|MCPツール統合をCLIとTUIに反映する|TASK-034,TASK-035,TASK-036|
|TASK-016|✅|スラッシュコマンドの確認を完了する|TASK-006|
|TASK-038|✅|デバッグ時インタラクティブ起動でリビジョン番号を表示する|TASK-006|
|TASK-039|✅|TUIでスラッシュコマンド候補のインクリメンタル表示とレイアウト整備を完了する|TASK-010,TASK-016|
|TASK-040|✅|デバッグ時インタラクティブ起動でビルド日時を表示する|TASK-038|
|TASK-041|✅|TUI起動時にヒント行のみ表示し/入力時に候補を表示する|TASK-039|
|TASK-042|✅|TUIをオルタネートスクリーンなしで表示する|TASK-010|
|TASK-043|✅|TUIの終了をCtrl+Cに限定し通常入力を阻害しない|TASK-010|
|TASK-044|✅|TUI描画の起点を現在行に合わせて上部描画を回避する|TASK-010|
|TASK-045|✅|TUI描画前に下方向に改行し描画領域をクリアする|TASK-010|
|TASK-046|✅|TUIでLLM問い合わせを実行できるようにする|TASK-025|
|TASK-047|✅|TUI入力カーソルを入力行末に追従させる|TASK-010|
|TASK-048|✅|TUI起動時にビルド情報と終了方法を表示する|TASK-006|
|TASK-049|✅|TUIのログ表示を上部に配置し入力欄を下部に配置する|TASK-010|
|TASK-050|✅|TUIでtokio runtimeの二重起動を回避する|TASK-046|
|TASK-051|✅|TUIのステータス行にモデル名とビルド時刻を表示する|TASK-010|
|TASK-052|✅|TUIの入力送信をログに反映し候補行の表示を最小化する|TASK-049|
|TASK-053|✅|TUIの候補表示を入力欄の下に出るレイアウトに変更する|TASK-049|
|TASK-054|✅|TUIのステータス行に実行中/待機中を表示する|TASK-049|
|TASK-055|✅|TUIのステータス行に動作中インジケータを追加する|TASK-054|
|TASK-056|✅|TUIの動作中インジケータを👺アニメーションにする|TASK-055|
|TASK-057|✅|TUIの動作中インジケータを移動アニメーションにする|TASK-056|
|TASK-058|✅|TUIの入力受付を安定化するためLLM処理を非同期委譲する|TASK-046|
|TASK-059|✅|TUI入力を即時ログ化し処理キューで直列実行する|TASK-058|
|TASK-061|✅|TUI実装をstate/render/controllerに分割する|TASK-049|
|TASK-062|✅|TUIレイアウトをログ/ステータス/入力の3領域に分離する|TASK-049|
|TASK-063|✅|TUIのアプリステータスを入力欄の下に分離表示する|TASK-062|
|TASK-064|✅|TUI入力欄の下部右端にショートカットヒントを配置する|TASK-062|
|TASK-065|✅|TUIのログとステータス間に区切り線を追加する|TASK-062|
|TASK-066|✅|TUIの処理ステータスとヘルプを同一領域で色分け表示する|TASK-062|
|TASK-067|✅|TUI結果エリアの拡張とスクロール挙動を調整する|TASK-062|
|TASK-068|✅|TUIの結果エリアの高さを上限3行に調整し最小表示を確保する|TASK-067|
|TASK-069|✅|TUIの入力履歴を上下キーで参照できるようにする|TASK-059|
|TASK-070|✅|TUIで結果を折りたたみ表示にする|TASK-059|
|TASK-071|✅|TUI処理中のCtrl+Cで現在の処理を中断する|TASK-059|
|TASK-073|✅|REPLモードを廃止してTUIに統一する|TASK-010|
|TASK-074|✅|ANSI描画プリミティブを実装する|TASK-073|
|TASK-087|✅|インライン描画状態を管理する構造を追加する|TASK-074|
|TASK-088|✅|TUI描画をANSIレンダリングに置換する|TASK-087|
|TASK-075|✅|TUIでLLM応答のストリーミング表示を実装する|TASK-088|
|TASK-076|✅|入力エリアを改行数に応じて可変高さにする|TASK-088|
|TASK-077|⏳|処理ステータス表示を入力エリア内に統合する|TASK-088|
|TASK-078|⏳|結果エリアの拡張ルール（5行未満に縮小しない）を実装する|TASK-088|
|TASK-079|⏳|フッターをANSIで固定再描画する（実現不可時は入力近傍に表示）|TASK-088|
|TASK-080|⏳|ツール実行許可UI（y/n/a/d）を実装する|TASK-088|
|TASK-081|⏳|結果エリアでMarkdownレンダリング（コードハイライト含む）を実装する|TASK-075|
|TASK-082|⏳|フッターにトークン/コスト表示を追加する|TASK-079|
|TASK-083|⏳|ユーザー入力とAI応答を視覚的に区別して表示する|TASK-075|
|TASK-084|⏳|思考表示（折りたたみ）を実装する|TASK-075|
|TASK-085|⏳|Todoリスト表示UIを実装する|TASK-088|
|TASK-086|⏳|エラー表示の色分け・折りたたみ仕様を実装する|TASK-088|
|TASK-072|✅|TUIレイアウト仕様をdocsに整理する|TASK-062|

### Phase 4: 品質・ドキュメント

|ID|Status|Summary|DependsOn|
|----|--------|---------|-----------|
|TASK-019|⏳|テストスイートの実装と確認を完了する|TASK-003,TASK-004,TASK-005|
|TASK-020|⏳|必須ドキュメント一式を作成する|TASK-003,TASK-004,TASK-005|
|TASK-021|⏳|パフォーマンス計測と閾値検証を完了する|TASK-010,TASK-011|

### Phase 5: Backlog（リリース前TODO）

|ID|Status|Summary|DependsOn|
|----|--------|---------|-----------|
|TASK-022|⏳|複数LLM実接続の拡張TODOを整理する|TASK-007|
|TASK-023|⏳|高度機能群の拡張TODOを整理する|TASK-014|
|TASK-015|⏳|フック機構の確認を完了する|TASK-005,TASK-006|
|TASK-017|⏳|Git統合の確認を完了する|TASK-005,TASK-006|
|TASK-018|⏳|認証管理と監査ログの確認を完了する|TASK-003,TASK-013|
|TASK-060|⏳|TUI入力を文脈で束ねて進行中処理へ反映する|TASK-059|

## Task Details (only when clarification needed)

### TASK-022

- Note: リリース向けの複数プロバイダー実接続を後段に回す

### TASK-023

- Note: メモリー/チェックポイント/KB/クラウド/レビューモードを含む

### TASK-007

- Note: LLMは推論/生成のみ、エージェント意思決定はTenguで行う

### TASK-024

- Note: ベンダー固有のエージェント機能には依存しない

### TASK-025

- Note: 対話入力をLLMに送信し応答を表示する

### TASK-027

- Note: LLM応答がJSONのときRead/Write等のツールを実行できるようにする

### TASK-028

- Note: 指示→計画→実行→結果の最小ループを持つ

### TASK-029

- Note: LLM応答から使用ツールを決定できるようにする

### TASK-030

- Note: 書き込み前に差分を提示できるようにする

### TASK-031

- Note: 失敗理由をLLMに渡し再試行できるようにする

### TASK-014

- Note: TASK-032〜TASK-037 の完了で確認完了とする

### TASK-032

- Note: STDIO と HTTP/SSE の仕様を調査して要点をまとめる
- Note: ツール名は名前空間で区別する

### TASK-033

- Note: 設定保存先は .tengu/mcp.toml を使用する

### TASK-035

- Note: ツール参照は @server/tool 形式で扱う

### TASK-036

- Note: ツール参照は @server/tool 形式で扱う

### TASK-037

- Note: CLI と TUI の双方で MCP 一覧/選択を扱う
